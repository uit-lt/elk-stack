input {
  file {
    path => "/usr/share/logstash/data/employees.csv"
    start_position => "beginning"
    sincedb_path => "/dev/null"
  }
  file {
      path => "/usr/share/logstash/data/2_people_data_2k.csv"
      start_position => "beginning"
      sincedb_path => "/dev/null"
  }
  file {
    path => "/usr/share/logstash/data/2_connections_data_300k.csv"
    start_position => "beginning"
    sincedb_path => "/dev/null"
  }
}

filter {
    if [path] =~ "employees.csv" {
      csv {
        separator => ","
        columns => ["id", "name", "code", "salary"]
      }
      mutate {
        convert => {
          "id" => "integer"
          "name" => "string"
          "code" => "integer"
          "salary" => "float"
        }
      }
    } else if [path] =~ "2_people_data_2k.csv" {
      csv {
        separator => ","
        columns => ["id", "name", "age"]
      }
      mutate {
        convert => {
          "id" => "integer"
          "name" => "string"
          "age" => "integer"
        }
      }
    } else if [path] =~ "2_connections_data_300k.csv" {
      csv {
        separator => ","
        columns => ["src", "dst", "relationship"]
      }
      mutate {
        convert => {
          "src" => "string"
          "dst" => "integer"
          "relationship" => "string"
        }
      }
    }
}

output {
  if [path] =~ "employees.csv" {
    elasticsearch {
      hosts => "${ELASTIC_HOSTS}"
      user => "elastic"
      password => "${ELASTIC_PASSWORD}"
      index => "employees"
    }
  } else if [path] =~ "2_people_data_2k.csv" {
    elasticsearch {
      hosts => "${ELASTIC_HOSTS}"
      user => "elastic"
      password => "${ELASTIC_PASSWORD}"
      index => "2_people_data_2k"
    }
  } else if [path] =~ "2_connections_data_300k.csv" {
    elasticsearch {
      hosts => "${ELASTIC_HOSTS}"
      user => "elastic"
      password => "${ELASTIC_PASSWORD}"
      index => "2_connections_data_300k"
    }
  }
  stdout { codec => rubydebug }
}
