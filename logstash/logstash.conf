input {
  file {
    path => "/usr/share/logstash/data/employees.csv"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    add_field => { "filename" => "employees.csv" }
  }
  file {
    path => "/usr/share/logstash/data/2_people_data_2k.csv"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    add_field => { "filename" => "2_people_data_2k.csv" }
  }
  file {
    path => "/usr/share/logstash/data/2_connections_data_300k.csv"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    add_field => { "filename" => "2_connections_data_300k.csv" }
  }
  file {
    path => "/var/log/dpkg.log"
    start_position => "beginning"
  }
}

filter {
  if [filename] == "employees.csv" {
    csv {
      separator => ","
      columns => ["id", "name", "code", "salary"]
    }
    mutate {
      convert => {
        "id" => "integer"
        "name" => "string"
        "code" => "integer"
        "salary" => "float"
      }
    }
  } else if [filename] == "2_people_data_2k.csv" {
    csv {
      separator => ","
      columns => ["id", "name", "age"]
    }
    mutate {
      convert => {
        "id" => "integer"
        "name" => "string"
        "age" => "integer"
      }
    }
  } else if [filename] == "2_connections_data_300k.csv" {
    csv {
      separator => ","
      columns => ["src", "dst", "relationship"]
    }
    mutate {
      convert => {
        "src" => "integer"
        "dst" => "integer"
        "relationship" => "string"
      }
    }
  }
}

output {
  if [filename] == "employees.csv" {
    elasticsearch {
      hosts => "${ELASTIC_HOSTS}"
      user => "elastic"
      password => "${ELASTIC_PASSWORD}"
      index => "employees"
    }
  } else if [filename] == "2_people_data_2k.csv" {
    elasticsearch {
      hosts => "${ELASTIC_HOSTS}"
      user => "elastic"
      password => "${ELASTIC_PASSWORD}"
      index => "2_people_data_2k"
    }
  } else if [filename] == "2_connections_data_300k.csv" {
    elasticsearch {
      hosts => "${ELASTIC_HOSTS}"
      user => "elastic"
      password => "${ELASTIC_PASSWORD}"
      index => "2_connections_data_300k"
    }
  } else if [filename] == "dpkg.log" {
    elasticsearch {
      hosts => "${ELASTIC_HOSTS}"
      user => "elastic"
      password => "${ELASTIC_PASSWORD}"
      index => "logstash-%{+YYYY.MM.dd}"
    }
  }
  stdout { codec => rubydebug }
}
